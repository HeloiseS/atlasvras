
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>The Data &#8212; ATLAS VRAs unknown documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=4e48d009"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'data';</script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The Models" href="training.html" />
    <link rel="prev" title="The Virtual Research Assistant" href="about.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="ATLAS VRAs unknown documentation - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="ATLAS VRAs unknown documentation - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">TL;DR</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="eyeball.html">Cheat Sheet</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">The Deets</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="about.html">The VRA</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">The Data</a></li>


<li class="toctree-l1"><a class="reference internal" href="training.html">The Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="el01z.html">Monitoring</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">For Devs</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual.html">Manual</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/data.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>The Data</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">The Data</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#time-windows-explained">Time windows explained</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#some-caveats">Some Caveats</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-and-validation-sets">Training and Validation sets</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#the-features">The Features</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#day-1-models">Day 1 models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#day-n-features">Day N features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#forced-vs-unforced-photometry">Forced Vs Unforced Photometry</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importance">Feature Importance</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#real-scoremodel-day1-features">Real ScoreModel - day1 Features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#galactic-score-model-day1-features">Galactic Score Model - day1 Features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">day N features</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="the-data">
<h1>The Data<a class="headerlink" href="#the-data" title="Link to this heading">#</a></h1>
<p>The current family of models is called <code class="docutils literal notranslate"><span class="pre">Duck</span></code> and encompasses
data gathered between <code class="docutils literal notranslate"><span class="pre">2024-03-27</span></code> and <code class="docutils literal notranslate"><span class="pre">2024-01-22</span></code>.
It is a super-set of the <code class="docutils literal notranslate"><span class="pre">Crabby</span></code> data gathered between  <code class="docutils literal notranslate"><span class="pre">2024-03-27</span></code> and <code class="docutils literal notranslate"><span class="pre">2024-08-13</span></code>,
with an additional few months of data gathered between <code class="docutils literal notranslate"><span class="pre">2024-08-18</span></code> and <code class="docutils literal notranslate"><span class="pre">2025-01-22</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The naming convention is as follows: new names are chosen for new
data sets(not new features), with their names starting with incremented
letters of the alphabet. The Duck data-set is the fourth iteration of the VRA
training set.</p>
</div>
<section id="time-windows-explained">
<h2>Time windows explained<a class="headerlink" href="#time-windows-explained" title="Link to this heading">#</a></h2>
<p>The start date corresponds to our implementation of the systems that record human
decisions as they are being made.
We chose to only train on alerts whose data could be recorded
as the human decisions were being made so that we have a truthful
record of what they looked like at the time.</p>
<p>Because of updates in e.g. the <code class="docutils literal notranslate"><span class="pre">Sherlock</span></code> cross-matching in some
older data in the database, recreating the conditions under which each alert
was eyeballed is non trivial and since we get a constant influx of new data,
we opted for the thrifty option of using data we could control fully.
The August cut off is chosen such that these data are not affected
by any human-machine interaction considerations.</p>
<p>The data downloaded is what is returned by the <a class="reference external" href="https://heloises.github.io/atlasapiclient/users.html">ATLAS API</a>, for the schema
you can check the <a class="reference external" href="https://psweb.mp.qub.ac.uk/misc/api/atlas/">json schema</a>. It is cleaned up into a few csv files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">contextual_info_data_set.csv</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">detections_data_set.csv</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">non_detections_100days.csv</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vra_last_entry_withmjd.csv</span></code></p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>You can get the data and the codes used to clean it up <strong>[HERE ADD ZENODO]</strong></p>
</div>
</section>
<section id="some-caveats">
<h2>Some Caveats<a class="headerlink" href="#some-caveats" title="Link to this heading">#</a></h2>
<ol class="arabic">
<li><p>Most human-labelled alerts were handled by <strong>only one eyeballer</strong> (apart from a few exceptions
posted on slack and the 2000 or so I re-eyeballed). Ideally for a well curated data set we would want
two to three opinions especially for borderline cases. Here are a few ways this will affect the current data:</p>
<ol class="loweralpha simple">
<li><p>Not all eyeballers use the Proper Motion star list. They will just
put proper motion alerts in the garbage. This will lead to some confusion
between the <code class="docutils literal notranslate"><span class="pre">garbage</span></code> and <code class="docutils literal notranslate"><span class="pre">pm</span></code> alerts.</p></li>
<li><p>Most eyeballers will put galactic events in the <code class="docutils literal notranslate"><span class="pre">good</span></code> list if another team
has mistakenly added those to the TNS. This will lead to some confusion
between the <code class="docutils literal notranslate"><span class="pre">galactic</span></code> and <code class="docutils literal notranslate"><span class="pre">good</span></code> alerts.</p></li>
</ol>
</li>
<li><p>The  <code class="docutils literal notranslate"><span class="pre">galactic</span></code> tag is actually an <code class="docutils literal notranslate"><span class="pre">attic</span></code> list tag. But the attic list also used to contains the following
which will lead to further confusion between the <code class="docutils literal notranslate"><span class="pre">galactic</span></code> and <code class="docutils literal notranslate"><span class="pre">good</span></code> alerts:</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>Duplicate supernovae (As of 2025-01-30 we have a duplicate list so they will no longer be in the attic; this will not affect future datasets bu it affects all of Duck)</p></li>
<li><p>Suspected AGN activity</p></li>
</ol>
</div></blockquote>
</li>
<li><p>In the additional data brought by the <code class="docutils literal notranslate"><span class="pre">Duck</span></code> data set (from the 13th August 2025 onwards)
the VRA was active and auto-garbaging data. This means that a very large fraction of the data recorded
from that data didn’t receive human eyeballing and was not split into <code class="docutils literal notranslate"><span class="pre">PM</span></code> or <code class="docutils literal notranslate"><span class="pre">garbage</span></code>.
To avoid mass re-eyeballing I used the <code class="docutils literal notranslate"><span class="pre">Crabby</span></code>-trained VRA to predict <code class="docutils literal notranslate"><span class="pre">p_real</span></code> and <code class="docutils literal notranslate"><span class="pre">p_gal</span></code> for the new data
and I assumed the following labels:
a.  <code class="docutils literal notranslate"><span class="pre">p_real&lt;0.2</span></code>, <code class="docutils literal notranslate"><span class="pre">p_gal&lt;0.1</span></code> = <code class="docutils literal notranslate"><span class="pre">Garbage</span></code>
b. <code class="docutils literal notranslate"><span class="pre">p_real&lt;0.2</span></code>, <code class="docutils literal notranslate"><span class="pre">p_gal&gt;0.9</span></code> = <code class="docutils literal notranslate"><span class="pre">PM</span></code></p></li>
</ol>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The new iteration of the VRA works really well despite some of the grabage and PM being labelled by the previous model.
I am considering trying to use auto-garbage just as a preal == 0 label and not try to use PM and garbage to train the galactic classifier.</p>
</div>
</section>
<section id="training-and-validation-sets">
<h2>Training and Validation sets<a class="headerlink" href="#training-and-validation-sets" title="Link to this heading">#</a></h2>
<p>The data eyeballed over the period covered by <code class="docutils literal notranslate"><span class="pre">crabby</span></code> includes over
40,000 alerts, 88% of which were either Garbage or Proper Motion stars.
Roughly 5.5% were classified as <code class="docutils literal notranslate"><span class="pre">good</span></code> and 6.5% as <code class="docutils literal notranslate"><span class="pre">galactic</span></code> (i.e. put
in the attic).</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/pie_chart.png"><img alt="_images/pie_chart.png" src="_images/pie_chart.png" style="width: 500px;" />
</a>
</figure>
<p>In the additional data set included in <code class="docutils literal notranslate"><span class="pre">Duck</span></code> we have over 34k new alerts
but a significant fraction that were auto-garbaged - handled automatically by the VRA.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/pie_chart_duck.png"><img alt="_images/pie_chart_duck.png" src="_images/pie_chart_duck.png" style="width: 500px;" />
</a>
</figure>
<p>With these data we create a (somewhat) <strong>balanced</strong> training set and an <strong>unbalanced</strong>
validation set that we will use to check that our models generalise decently and
to tune some hyperparameters.
We do this by randomly sampling 15% of our alerts <em>before</em> balancing
to be our validation set.</p>
<p>We then balance what’s left to make our training set.
We use <strong>undersampling</strong> of the larger categories (<code class="docutils literal notranslate"><span class="pre">pm</span></code> and <code class="docutils literal notranslate"><span class="pre">garbage</span></code>)
rather than oversampling of the smaller categories.
I started with that because I didn’t want to duplicate data and the models
were working decently with just a few thousand samples, but oversampling
has not actually been tested and compared.</p>
<p>When making the <code class="docutils literal notranslate"><span class="pre">Duck</span></code> validation set I do not re-sample the whole dataset from
March 2024. Instead I take the same validation set as in <code class="docutils literal notranslate"><span class="pre">Crabby</span></code> and sample
from 15% of the extra data from August 2025 onwards.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We do not call it a <strong>test set</strong> because it isn’t : we use it to check our models
hyperparameters and decided if we want to keep or add features. A real test set
is an unseen data set we <strong>only use to calculate performance metrics</strong>.
Realistically, we test in prod.</p>
</div>
<p>We keep the validation set unbalanced so that it is representative of
what the model will see in production so that the metrics we calculate to
check performance and generalisation are representative of what we might
see in real life.</p>
<p>The number of alerts in our training and validation sets are shown in the
table below. As you can see the training set is <em>slightly</em> unbalanced
with 300 more <code class="docutils literal notranslate"><span class="pre">garbage</span></code>, <code class="docutils literal notranslate"><span class="pre">pm</span></code> and <code class="docutils literal notranslate"><span class="pre">galactic</span></code> alerts than <code class="docutils literal notranslate"><span class="pre">good</span></code> alerts.
That’s because I wanted to keep as large a training set as possible
so I balanced based on the number of <code class="docutils literal notranslate"><span class="pre">galactic</span></code> alerts. The slight imbalance
did not affect the model’s performance in early tests (but we did
try training on the unbalanced training set and it was a disaster).</p>
<p>The training set is not fully balanced because I didn’t want to downsample <code class="docutils literal notranslate"><span class="pre">Good</span></code> objects
in the additional data available in <code class="docutils literal notranslate"><span class="pre">Duck</span></code>.
Also note the training and validation data sets include some guess labels but the
reported numbers for the whole data set do not.</p>
</section>
</section>
<section id="the-features">
<h1>The Features<a class="headerlink" href="#the-features" title="Link to this heading">#</a></h1>
<section id="day-1-models">
<h2>Day 1 models<a class="headerlink" href="#day-1-models" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">day1</span></code> models are those that calculate the initial real and galactic
scores when an alert first enters the eyeball list.
They currently use the following features:</p>
<div class="pst-scrollable-table-container"><table class="table" id="id2">
<caption><span class="caption-text">Features</span><a class="headerlink" href="#id2" title="Link to this table">#</a></caption>
<colgroup>
<col style="width: 33.3%" />
<col style="width: 16.7%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Category</p></th>
<th class="head"><p>Feature</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Light curve long term history (last 100 days)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Nnondet_std</span></code></p></td>
<td><p>Standard deviation of the number of non detections between each detection</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Nnondet_mean</span></code></p></td>
<td><p>Mean of the number of non detections between each detection</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">magdet_std</span></code></p></td>
<td><p>Standard deviation of the magnitude of each historical detection</p></td>
</tr>
<tr class="row-odd"><td><p>Light curve recent history (last 5 days)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">DET_Nsince_min5d</span></code></p></td>
<td><p>Number of detections</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NON_Nsince_min5d</span></code></p></td>
<td><p>Number of non detections</p></td>
</tr>
<tr class="row-odd"><td><p>Positional scatter recent history (last 5 days)</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">log10_std_ra_min5d</span></code></p></td>
<td><p>Log10 of the standard deviation of the RA</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">log10_std_dec_min5d</span></code></p></td>
<td><p>Log10 of the standard deviation of the Dec</p></td>
</tr>
<tr class="row-odd"><td><p>Contextual Information</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ra</span></code></p></td>
<td><p>Right Ascension</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">dec</span></code></p></td>
<td><p>Declination</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">rb_pix</span></code></p></td>
<td><p>Real/bogus score from the CNN</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">z</span></code></p></td>
<td><p>Spectroscopic redshift</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">photoz</span></code></p></td>
<td><p>Photometric redshift</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ebv_sfd</span></code></p></td>
<td><p>E(B-V) (extinction in magnitudes)</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">log10_sep_arcsec</span></code></p></td>
<td><p>Log10 of the separation in arcsec from a nearby source</p></td>
</tr>
<tr class="row-even"><td><p>Boolean flags for the following sherlock feature:</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">CV</span></code></p></td>
<td><p>Known Cataclysmic Variable</p></td>
</tr>
</tbody>
</table>
</div>
<p>The Sherlock features <code class="docutils literal notranslate"><span class="pre">SN</span></code>, <code class="docutils literal notranslate"><span class="pre">ORPHAN</span></code>, <code class="docutils literal notranslate"><span class="pre">NT</span></code>, <code class="docutils literal notranslate"><span class="pre">UNCLEAR</span></code>, as they are not found to
be informative. It’s unsurprising as we are providing information used by sherlock to create those tags
(such as the separation from the nearby source or the redshift) so it uses those and not the boolean flags.
<code class="docutils literal notranslate"><span class="pre">CV</span></code> is useful to an extent because it’s a direct classification (but often the VRA can guess it’s galactic).</p>
</section>
<section id="day-n-features">
<h2>Day N features<a class="headerlink" href="#day-n-features" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">dayN</span></code>  models update the real and galactic scores when new
information becomes available, that is, when ATLAS has visited that part of the
sky again and has either seen something or seen nothing (Either way
it might tell us something about the event).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">dayN</span></code> models use all the features of the <code class="docutils literal notranslate"><span class="pre">day1</span></code> models plus
an additional set of lightcurve features to try to capture the evolution
of the lightcurve.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">dayN</span></code> features are calculated from -5 days to +15 days w.r.t
the alert date.</p>
</div>
<div class="pst-scrollable-table-container"><table class="table" id="id3">
<caption><span class="caption-text">Additional features for the <code class="docutils literal notranslate"><span class="pre">dayN</span></code> models.</span><a class="headerlink" href="#id3" title="Link to this table">#</a></caption>
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Feature</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DET_N_total</span></code></p></td>
<td><p>Number of detections since phase -5 d</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DET_mag_median</span></code></p></td>
<td><p>Median magnitude of the detections since phase -5 d</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">NON_mag_median</span></code></p></td>
<td><p>Median magnitude of the non detections since phase -5 d</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">NON_N_total</span></code></p></td>
<td><p>Number of non detections since phase -5 d</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">max_mag</span></code></p></td>
<td><p>Maximum (median) magnitude seen since phase -5 d</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">max_mag_day</span></code></p></td>
<td><p>Day of the maximum magnitude</p></td>
</tr>
</tbody>
</table>
</div>
<p>The features <code class="docutils literal notranslate"><span class="pre">DET_N_today</span></code>, <code class="docutils literal notranslate"><span class="pre">NON_N_today</span></code>.
were pruned as they were found to be useless (even in the previous iteration of the model).
It makes sense that these features are not useful: The number of detections or non detections today
is just a subset of the total number of detections or non detections.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Technically taking the median of a magnitude is not the proper way to bin
a magnitude. But it’s quick and good enough and we have to do these
operation over and over. There is nothing to gain from going into flux space
and binning in there.</p>
</div>
</section>
<section id="forced-vs-unforced-photometry">
<h2>Forced Vs Unforced Photometry<a class="headerlink" href="#forced-vs-unforced-photometry" title="Link to this heading">#</a></h2>
<p>The light curve features are calculated on the <strong>unforced</strong> photometry.
This is quite limiting and in future iterations we will need to include forced
photometry to get more useful features.
The relation between detections and non detections changes with weather and
the phase of the moon. I tried to capture that by having features that count
both and measure both. But this is a loosing battle.</p>
<p><strong>We need forced photometry</strong> to do a decent job of the lightcurve
features. The challenge is that forced photometry is expensive to calculate
so we don’t want to do that on everything in the stream.
<strong>[NOTE: in Lasair we have FP for ZTF, will we get that for LSST?]</strong></p>
</section>
</section>
<section id="feature-importance">
<h1>Feature Importance<a class="headerlink" href="#feature-importance" title="Link to this heading">#</a></h1>
<p>The features described above were chosen based on my conversations
with the eyeballers and my own eyeballing experience,
but whether and how much they contribute to the model is only
something we can assess once we have trained them.</p>
<p>To explore that we can look at the <a class="reference external" href="https://scikit-learn.org/stable/modules/permutation_importance.html">permutation importance</a> of our features.
The basic concept is simple: you take a feature column and shuffle it. Then
you retrain the model and see how much worse the predictions are.
<strong>The worse you do when you scramble a feature, the more important that feature is.</strong></p>
<section id="real-scoremodel-day1-features">
<h2>Real ScoreModel - day1 Features<a class="headerlink" href="#real-scoremodel-day1-features" title="Link to this heading">#</a></h2>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="_images/permpimp_day1Real_light.png"><img alt="_images/permpimp_day1Real_light.png" src="_images/permpimp_day1Real_light.png" style="width: 700px;" />
</a>
<figcaption>
<p><span class="caption-text">Permutation importance of the day 1 features for the real scoring model</span><a class="headerlink" href="#id4" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p><code class="docutils literal notranslate"><span class="pre">rb_pix</span></code> being the most important feature is not surprising.
But some of the other important features may seem a bit odd. Why would the
<code class="docutils literal notranslate"><span class="pre">log10_sep_arcsec</span></code> be so high on the list? Likely because
bad subtractions and artefacts from proper motion stars happen in
the vicinity of the cross matches.</p>
<p><code class="docutils literal notranslate"><span class="pre">RA</span></code> and <code class="docutils literal notranslate"><span class="pre">dec</span></code> are also very important because bogus alerts are often
found in the galactic plane (note in BMO, a previous version, we did try
to use the galactic coordinates to do the training but it gave worse results!).
<code class="docutils literal notranslate"><span class="pre">ebv_sfd</span></code> is also somewhat significant, likely because it’s a proxy for the
galactic plane and crowded fields that yield more artefacts
rather than extinction directly causing bogus alerts.</p>
<p>Some features like <code class="docutils literal notranslate"><span class="pre">z</span></code> and <code class="docutils literal notranslate"><span class="pre">photoz</span></code> are not important here (as expected),
but they will be for the galactic model which is why they’re included.</p>
</section>
<section id="galactic-score-model-day1-features">
<h2>Galactic Score Model - day1 Features<a class="headerlink" href="#galactic-score-model-day1-features" title="Link to this heading">#</a></h2>
<figure class="align-center" id="id5">
<a class="reference internal image-reference" href="_images/permpimp_day1Gal_light.png"><img alt="_images/permpimp_day1Gal_light.png" src="_images/permpimp_day1Gal_light.png" style="width: 700px;" />
</a>
<figcaption>
<p><span class="caption-text">Permutation importance of the day 1 features for the gal scoring model</span><a class="headerlink" href="#id5" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>For the galactic scores, the most important feature is <code class="docutils literal notranslate"><span class="pre">ebv_sfd</span></code>, as
one might expect (since anything with too high an extinction will automatically
and safely get a galactic tag).
<code class="docutils literal notranslate"><span class="pre">rb_pix</span></code> is also important, which is somewhat surprising but likely a result
of how RB score is affected by bad subtractions in the galactic plane or by
proper motion star.</p>
<p>Again  <code class="docutils literal notranslate"><span class="pre">log10_sep_arcsec</span></code> is important, and I suspect it is a proxy for
whether an alert is associated with a galaxy. As we can see in the
<code class="docutils literal notranslate"><span class="pre">sherlock</span></code> features, <code class="docutils literal notranslate"><span class="pre">SN</span></code> and <code class="docutils literal notranslate"><span class="pre">NT</span></code> are NOT nearly as important as
we might have thought (in fact <code class="docutils literal notranslate"><span class="pre">NT</span></code> looks like it hinders a bit!).
This is likely a result of the fact that a lot of “extended” sources in the PS
catalogues are actually stars, and to be more complete with the <code class="docutils literal notranslate"><span class="pre">SN</span></code> tag
<code class="docutils literal notranslate"><span class="pre">sherlock</span></code> allows for a lot of contamination. For our model that means
that the <code class="docutils literal notranslate"><span class="pre">SN</span></code> category is not very informative, <em>but</em> using the separation
directly allows it to infer whether the source is likely to be a SN (they’re usually
offset, whereas stars and NT aren’t).</p>
<p>Finally note that <code class="docutils literal notranslate"><span class="pre">z</span></code> and <code class="docutils literal notranslate"><span class="pre">photoz</span></code> are now showing some importance,
as we expected.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><em>“Why don’t you get rid of unimportant features or use different features for the</em>
<em>galactic and real models?”</em> Because the models we use are robust to “useless”
features and it’s easier in prod to calculate all the features at once and then parse
them to the two models. Eventually we might prune the features that are useless
for both.</p>
</div>
</section>
<section id="id1">
<h2>day N features<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>So what about the <code class="docutils literal notranslate"><span class="pre">dayN</span></code> models and the extra features we added?
The plots are big and bulky so I’m not adding them here, but you will be
able to find them in the paper or in the data release.
Here is the general gist.</p>
<dl class="simple">
<dt>For the real and galactic models the features that have the most impact are</dt><dd><p><code class="docutils literal notranslate"><span class="pre">max_mag</span></code>  and <code class="docutils literal notranslate"><span class="pre">max_mag_day</span></code>.</p>
</dd>
</dl>
<p>For the real scorer <code class="docutils literal notranslate"><span class="pre">DET_N_TOTAL</span></code> (the total number of detections) so far
is also important. <strong>Everything else has little to no impact</strong>.
To be fair human eyeballers really rely on the forced photometry in this regime
to make decisions, so trying to tease out other features on the raw phot is
probably beating a dead horse. It was worth a go.</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="about.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">The Virtual Research Assistant</p>
      </div>
    </a>
    <a class="right-next"
       href="training.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">The Models</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">The Data</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#time-windows-explained">Time windows explained</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#some-caveats">Some Caveats</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-and-validation-sets">Training and Validation sets</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#the-features">The Features</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#day-1-models">Day 1 models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#day-n-features">Day N features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#forced-vs-unforced-photometry">Forced Vs Unforced Photometry</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importance">Feature Importance</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#real-scoremodel-day1-features">Real ScoreModel - day1 Features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#galactic-score-model-day1-features">Galactic Score Model - day1 Features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">day N features</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Heloise Stevance
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Heloise Stevance.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>